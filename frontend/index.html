<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>–°–∫–∞–Ω–µ—Ä –∫–æ—Å–º–µ—Ç–∏–∫–∏</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      .result {
        margin-top: 20px;
      }
      .danger {
        color: red;
      }
      .warning {
        color: orange;
      }
      .safe {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>üß¥ –°–∫–∞–Ω–µ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –∫–æ—Å–º–µ—Ç–∏–∫–∏</h1>
    <form id="uploadForm">
      <input
        type="file"
        id="imageInput"
        name="image"
        accept="image/*"
        required
      />
      <button type="submit">–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
    </form>

    <div class="result" id="result"></div>

    <script>
      const form = document.getElementById("uploadForm");
      const resultDiv = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById("imageInput");
        const formData = new FormData();
        formData.append("image", fileInput.files[0]);

        resultDiv.innerHTML = "‚è≥ –ê–Ω–∞–ª—ñ–∑—É—é...";

        const response = await fetch("http://127.0.0.1:5000/analyze", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        if (data.error) {
          resultDiv.innerHTML = `<p style="color: red;">–ü–æ–º–∏–ª–∫–∞: ${data.error}</p>`;
          return;
        }

        const ingredients = data.risky_ingredients;
        const raw = data.raw_text.replace(/\n/g, "<br>");

        let html = `<p><strong>üîç –¢–µ–∫—Å—Ç –∑ —Ñ–æ—Ç–æ:</strong><br>${raw}</p>`;

        if (ingredients.length === 0) {
          html += `<p class="safe">‚úÖ –®–∫—ñ–¥–ª–∏–≤–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!</p>`;
        } else {
          html += `<p class="danger">‚ö†Ô∏è –ó–Ω–∞–π–¥–µ–Ω–æ ${ingredients.length} –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤:</p><ul>`;
          for (let item of ingredients) {
            html += `<li><strong>${item.name}</strong> (${item.match}) ‚Äî <em>${item.description}</em> [${item.risk}]</li>`;
          }
          html += `</ul>`;
        }

        resultDiv.innerHTML = html;
      });
    </script>
  </body>
</html>
