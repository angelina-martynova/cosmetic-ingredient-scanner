<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–∫–∞–Ω–µ—Ä —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –∫–æ—Å–º–µ—Ç–∏–∫–∏</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background-color: #fff0f5;
        color: #333;
        padding: 2rem;
      }
      h1 {
        color: #d63384;
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }
      .container {
        max-width: 700px;
        margin: auto;
        background: #fff;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      input[type="file"] {
        display: block;
        margin: 1rem 0;
        padding: 0.5rem;
        border-radius: 10px;
        border: 1px solid #ccc;
      }
      button {
        background-color: #d63384;
        color: white;
        border: none;
        padding: 0.7rem 1.5rem;
        border-radius: 12px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s;
      }
      button:hover {
        background-color: #c21872;
      }
      .result {
        margin-top: 2rem;
      }
      .result h2 {
        color: #d63384;
      }
      .danger {
        color: #e63946;
        font-weight: bold;
      }
      .warning {
        color: #f77f00;
        font-weight: bold;
      }
      .safe {
        color: #2a9d8f;
        font-weight: bold;
      }
      ul {
        padding-left: 1.2rem;
      }
      li {
        margin-bottom: 0.5rem;
      }
      .ingredient-card {
        background: #fce4ec;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>–°–∫–∞–Ω–µ—Ä –∫–æ—Å–º–µ—Ç–∏—á–Ω–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h1>
      <form id="uploadForm">
        <input
          type="file"
          id="imageInput"
          name="image"
          accept="image/*"
          required
        />
        <button type="submit">–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
      </form>
      <div class="result" id="result"></div>
    </div>

    <script>
      const form = document.getElementById("uploadForm");
      const resultDiv = document.getElementById("result");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById("imageInput");
        const formData = new FormData();
        formData.append("image", fileInput.files[0]);

        resultDiv.innerHTML = "<p>‚è≥ –ê–Ω–∞–ª—ñ–∑—É—é...</p>";

        try {
          const response = await fetch("http://127.0.0.1:5000/analyze", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();
          if (data.error) {
            resultDiv.innerHTML = `<p class="danger">–ü–æ–º–∏–ª–∫–∞: ${data.error}</p>`;
            return;
          }

          const ingredients = data.risky_ingredients;
          const raw = data.raw_text.replace(/\n/g, "<br>");

          let html = `<h2>üîç –†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:</h2><p>${raw}</p>`;

          if (ingredients.length === 0) {
            html += `<p class="safe">‚úÖ –®–∫—ñ–¥–ª–∏–≤–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>`;
          } else {
            html += `<h2>‚ö†Ô∏è –í–∏—è–≤–ª–µ–Ω–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</h2>`;
            for (let item of ingredients) {
              let colorClass =
                item.risk === "High"
                  ? "danger"
                  : item.risk === "Medium"
                  ? "warning"
                  : "safe";
              html += `
              <div class="ingredient-card ${colorClass}">
                <strong>${item.name || item.match}</strong><br>
                <em>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</em> ${item.category || "–ù–µ–≤—ñ–¥–æ–º–æ"}<br>
                <em>–†–∏–∑–∏–∫:</em> ${item.risk}<br>
                <em>–û–ø–∏—Å:</em> ${item.description || "–ù–µ–º–∞—î –æ–ø–∏—Å—É"}
              </div>
            `;
            }
          }

          resultDiv.innerHTML = html;
        } catch (err) {
          resultDiv.innerHTML = `<p class="danger">–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∞–Ω–∞–ª—ñ–∑—É. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–µ —Ñ–æ—Ç–æ.</p>`;
          console.error(err);
        }
      });
    </script>
  </body>
</html>
