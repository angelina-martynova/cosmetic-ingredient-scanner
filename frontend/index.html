<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°–∫–∞–Ω–µ—Ä –∫–æ—Å–º–µ—Ç–∏—á–Ω–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #fff5fa;
        margin: 0;
        padding: 2rem;
        color: #333;
      }
      h1 {
        color: #d63384;
        text-align: center;
      }
      form {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 2rem;
      }
      input[type="file"] {
        margin: 1rem;
      }
      button {
        background-color: #d63384;
        color: white;
        padding: 0.6rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
      }
      .result {
        max-width: 800px;
        margin: auto;
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }
      .danger {
        background-color: #ffe3e3;
        padding: 0.5rem;
        border-radius: 5px;
        margin: 0.5rem 0;
        border-left: 5px solid #e03131;
      }
      .safe {
        background-color: #e3f9e5;
        padding: 0.5rem;
        border-radius: 5px;
        margin: 0.5rem 0;
        border-left: 5px solid #2f9e44;
      }
    </style>
  </head>
  <body>
    <h1>–°–∫–∞–Ω–µ—Ä –∫–æ—Å–º–µ—Ç–∏—á–Ω–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤</h1>

    <form id="upload-form">
      <input type="file" id="image" accept="image/*" required />
      <button type="submit">–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
    </form>

    <div class="result" id="result"></div>

    <script>
      const form = document.getElementById('upload-form');
      const resultDiv = document.getElementById('result');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        resultDiv.innerHTML = '<p>‚è≥ –ê–Ω–∞–ª—ñ–∑—É—î–º–æ...</p>';

        const formData = new FormData();
        const file = document.getElementById('image').files[0];
        formData.append('image', file);

        try {
          const response = await fetch('http://127.0.0.1:5000/analyze', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();

          if (data.status === 'success') {
            let html = `<h3>üîç –†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:</h3><pre>${data.text}</pre>`;

            if (data.ingredients.length === 0) {
              html += '<p class="safe">‚úÖ –®–∫—ñ–¥–ª–∏–≤–∏—Ö —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>';
            } else {
              html += '<h3>‚ö†Ô∏è –í–∏—è–≤–ª–µ–Ω—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:</h3>';
              data.ingredients.forEach(ing => {
                html += `<div class="danger">
                  <strong>${ing.name}</strong><br>
                  –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${ing.category}<br>
                  –†–∏–∑–∏–∫: ${ing.safety}<br>
                  ${ing.description}
                </div>`;
              });
            }

            resultDiv.innerHTML = html;
          } else {
            resultDiv.innerHTML = '<p class="danger">üö´ –ü–æ–º–∏–ª–∫–∞: ' + data.message + '</p>';
          }
        } catch (err) {
          resultDiv.innerHTML = '<p class="danger">üö´ –ù–µ –≤–¥–∞–ª–æ—Å—è –∑'—î–¥–Ω–∞—Ç–∏—Å—å –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.</p>';
          console.error(err);
        }
      });
    </script>
  </body>
</html>
